{% extends "base.html" %}
{% block content %}
<div class="main">
	<div class="row">
		<div class="col-md-12">
			<div class="text-wrap">
				获取旁站/c段
			</div>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-12">
			<div class="input-group-lg">
				<input type="text" id="url" class="form-control" aria-label="..." name="url">
                <input type="hidden" id="ip" class="form-control" aria-label="..." name="ip">
                <br>
                <center>
                <button type="button" id="pang" class="btn btn-info btn-lg " aria-haspopup="true" aria-expanded="false"><b>旁站</b></button>
			    &nbsp;&nbsp;<button type="button" id="cadd" class="btn btn-info btn-lg " aria-haspopup="true" aria-expanded="false"><b>C段</b></button>
                &nbsp;&nbsp;<button type="button" id="daochu" class="btn btn-info btn-lg " aria-haspopup="true" aria-expanded="false"><b>导出</b></button>
                </center>
            </div>
		</div>
    </div>
    <form action="saveapi" method="post" id="saveform">
        <input type="hidden" id="save">
    </form>
    <div class="row main-panel">
        <div class="col-md-1"></div>
			<div class="col-md-10">
				<div id="color" class="panel panel-primary">
					<div class="panel-heading" id="result">
						结果：
					</div>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>网址</th>
                            </tr>
                        </thead>
                    <tbody id="t_body">
                        <tr>
                            <td>$num</td>
                            <td>$num</td>

                        </tr>
                    </tbody>
                    </table>
                </div>
            </div>
    </div>
    <script type="text/javascript">

function request(ip){
    $.post(query,{'ip':ip},function (results){
        if(results){
            lengths=results.length;
            add_res="<tr><td>"+ip+"</td></tr>";
            for(var i in results){
                add_res+="<tr><td>"+i+"</td><td>"+results[i].domain+"</td></tr>";
                daochu+="{'domain':'"+result[i].domain+"'},"
            }
            $("#t_body").html(add_res)
        }else{
            add_res="<tr><td>结果为0</td></tr>";
        }
    },"json");
}

function urlcheck(url){
        if(url == "") {
            alert("请输入ip或者域名");
            return false;
        }else{
            return true;
        }
}


function furl2ip(url){
    $.post(url2ip,{'domain':url},function(data){
            return data.ip
        },"json");
}


$(function() {
    var url2ip="/api/returnjson";
    var query="someapi";
    var save="anotherapi";
    var url=$("#url").val();
    var daochu="";
    $("#pang").click(function() {
        if(urlcheck(url)){
            request(furl2ip(url))
        }
    });
    $("#cadd").click(function() {
        if(urlcheck(url)){
            ip=furl2ip(url)
            var arr = ip.split(".");
            if(ip){
                $("#result").html("结果：  "+ip)
                for(var count=0;count<255;count++){
                    var ips = arr[0] + "." + arr[1] + "." + arr[2] + "." + count;
                    request(ips)
                }
            }else{
                $.messager.alert("提示","网络链接异常","error");
            }
        }
    });
    $("#daochu").click(function(){
        daochu=daochu.substring(0,daochu.length-1);
        $("#save").val(daochu)
        $("#saveform").submit();

    });
});


</script>

</div>
{% endblock %}
